<html>
<head>
    <title>Vert.x sample</title>
    <link href="/static/css/style.css" rel="stylesheet">
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <script src="/static/js/jquery-1.8.2.min.js"></script>
    <script src="/static/js/sockjs-0.2.1.min.js"></script>
    <script src="/static/js/vertxbus-1.2.3.final.js"></script>
</head>
<body>
<script>
    var eb = null;

    function publish(address, message) {
        if (eb) {
            eb.publish(address, message);
        }
    }

    function subscribe(address) {
        if (eb) {
            eb.registerHandler(address, function (msg, replyTo) {
                $('#messages').append("<div class=\"" + msg.type + "\">" + msg.message + "</div>");
            });
        }
    }

    function closeConn() {
        if (eb) {
            eb.close();
        }
    }

    function openConn() {
        if (!eb) {
            eb = new vertx.EventBus("http://localhost:8080/eventbus");

            eb.onopen = function () {
                $("#status_info").text("Connected");
                subscribe("message.forclients");
            };

            eb.onclose = function () {
                $("#status_info").text("Not connected");
                eb = null;
            };
        }
    }

    $(document).ready(function () {
        $("#sendButton").click(function () {
            var json = {message:$("#message").val(), maxpersons:$("#maxpersons").val()};
            publish("message.newinvitation", json);
        });

        openConn();
    });

</script>
<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="brand" href="#">Vert.x sample</a>

            <div id="status_info">Not Connected</div>
        </div>
    </div>
</div>
<div class="container">
    <h1>Polyglot Message Center</h1>

    <p>Shows the different message types that are send using the vert.x event bus.</p>

    <div class="row">
        <div class="span8">
            <div id="messages">
                <h2>Your Messages</h2>
            </div>
        </div>
        <div class="span4">
            <div id="invitationForm">
                <form onsubmit="return false;">
                    Message : <input type="text" id="message" value="Kom je ook op mijn feestje"/><br/>
                    Max persons : <input type="text" id="maxpersons" value="10"/><br/>
                    <input type="button" id="sendButton" value="Create invitation"/>
                </form>
            </div>
        </div>
    </div>
</div>
</body>
</html>